<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>

    <title>Hello World - Google  Web Search API Sample</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/vue/1.0.26/vue.min.js"></script>

  </head>


  <body>

  <div id="app">
    <h1>instaClientId: {{ instaClientID }} </h1>
    <h1>instaClientSecret {{ instaClientSecret }} </h1>
    <h1>instaRedirect: {{ instaRedirect }} </h1>
    <h1>address: {{ address }} </h1>
    <h1 v-show="haveAccess">access_token: {{ access_token }} </h1>

    <button v-show="!haveAccess" @click="redirect">verify with insta</button>
    <button v-show="haveAccess" @click="setAccessfunction"> grab key</button>
    <button v-show="access_token != ''" @click="googleLocal">get that data</button>

  </div>

    <script>

    new Vue({
      el: "#app",

      data: {
        instaClientID: '63d392ef995d4ecebcfa2bff77725ede',
        instaClientSecret: '3d68c426fa7f487cb73ac78c66d9a7b4',
        instaRedirect: 'https://whitec54.github.io/MostLiked',
        address: '6802+UTSA+Boulevard',
        access_token: '',
      },

      computed: {
        instaAuthUrl: function() { return 'https://api.instagram.com/oauth/authorize/?client_id='+this.instaClientID +'&redirect_uri='+ this.instaRedirect +'&response_type=token&scope=public_content'},

        testAddress: function() { return 'https://maps.googleapis.com/maps/api/geocode/json?address='+address+'&sensor=false&feilds=location&key=AIzaSyAZqyVRzbtWVUptpJP1nskrdwtZh4iw8eA';},

        haveAccess: function(){ return window.location.hash}
      },

      methods: {
        redirect: function() { window.location.replace(this.instaAuthUrl); },

        setAccessfunction: function(){ this.access_token =  window.location.hash.substr(1);},

        googleLocal: function(){
          $.get(this.testAddress, function(data){

            var lat = data["results"][0]["geometry"]["location"]["lat"];
            var lng = data["results"][0]["geometry"]["location"]["lng"];

            console.log(lat.toString()+", "+lng.toString());

            console.log(access_token);


            var instaAddress = 'https://api.instagram.com/v1/media/search?lat='+lat.toString()+'&lng='+lng.toString()+'&'+access_token;

            console.log(instaAddress)

            $.ajax({
              type: "GET",
              dataType: "jsonp",
              url: instaAddress,
              success: function(data) {
                  console.log(data)
              }
            });
          });
        },
      }

    });


    </script>

  </body>
</html>
